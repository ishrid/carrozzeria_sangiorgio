{# carrozzeria_sangiorgio_project/templates/veicoli_detail.html #}
{% extends 'base.html' %}
{% load static %}
{% load humanize %} 
{% load custom_filters %}


{% block title %}{{ veicolo.marca }} {{ veicolo.modello }} ({{veicolo.anno}}) - Usato Garantito{% endblock %}

{% block head %}
<meta name="description" content="In vendita: {{ veicolo.marca }} {{ veicolo.modello }} del {{ veicolo.anno }} con {{ veicolo.chilometraggio }} Km. Scopri i dettagli e richiedi un test drive alla Carrozzeria San Giorgio.">
{# RIMOSSO GLightbox, AGGIUNTO LightGallery per coerenza con le altre pagine #}
<link rel="stylesheet" media="screen" href="{% static 'vendor/lightgallery/css/lightgallery-bundle.min.css' %}">

<style>
  /* Stili specifici per la pagina, il fix della galleria non è più necessario */
  body {
    overflow-x: hidden;
  }
  .veicolo-gallery-main img {
    max-height: 500px;
    width: 100%;
    object-fit: cover;
  }
  .veicolo-gallery-thumb {
    height: 150px;
    object-fit: cover;
    width: 100%;
  }
</style>
{% endblock %}

{% block content %}
<section class="position-relative pt-md-2 pt-lg-3 pt-xl-3 pb-5 pb-lg-0">
  <div class="position-absolute top-0 start-0 w-100 bg-secondary d-none d-lg-block"
       style="height: 792px; margin: -1px 0 0 -1px; background-size: 75px 75px;
              background-image: linear-gradient(to right, var(--ar-gray-200) 1px, transparent 1px),
                                  linear-gradient(to bottom, var(--ar-gray-200) 1px, transparent 1px);"></div>
  <div class="position-absolute top-0 start-0 w-100 h-100 bg-secondary d-lg-none"
       style="margin: -1px 0 0 -1px; background-size: 75px 75px;
              background-image: linear-gradient(to right, var(--ar-gray-200) 1px, transparent 1px),
                                  linear-gradient(to bottom, var(--ar-gray-200) 1px, transparent 1px);"></div>
  <div class="container position-relative z-2 pt-5 pb-2 pb-sm-3 pb-lg-0">
    <div class="py-5 mt-3 mt-sm-4 mb-md-3 mb-lg-4 mb-xl-5">
      <nav aria-label="breadcrumb">
        <ol class="pt-lg-3 pb-lg-4 pb-2 breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'main:home' %}">Home</a></li>
          <li class="breadcrumb-item"><a href="{% url 'vendita:lista_veicoli' %}">Vendita Veicoli</a></li>
          <li class="breadcrumb-item active" aria-current="page">{{ veicolo.marca }} {{ veicolo.modello }}</li>
        </ol>
      </nav>
<!--
      <h1 class="display-3 pb-1 pb-sm-2 pb-md-3">{{ veicolo.marca }} {{ veicolo.modello }}</h1>
      <p class="lead text-primary fs-2 fw-bold mb-4">{{ veicolo.prezzo|intcomma }} CHF</p>
    -->
      <h1 class=" lead   fs-2 fw-bold mb-4">{{ veicolo.marca }} {{ veicolo.modello }}</h1>
      <p class=" display-3 pb-1 pb-sm-2 pb-md-3 text-primary">CHF {{ veicolo.prezzo}}.-</p>

      {% if veicolo.status != 'disponibile' %}
        <span class="badge bg-dark fs-sm">{{ veicolo.get_status_display }}</span>
      {% endif %}
       
<div class="row">
    <div class="col-md-3">
<ul class="list-unstyled mb-3  ">
                           
                            <li class="mb-3"><p >
                                <svg xmlns="http://www.w3.org/2000/svg"
     width="24" height="24"
     viewBox="0 0 24 24"
     fill="none"
     stroke="currentColor"
     stroke-width="2"
     stroke-linecap="round"
     stroke-linejoin="round">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
  <line x1="3" y1="10" x2="21" y2="10"></line>
  <line x1="8" y1="2" x2="8" y2="6"></line>
  <line x1="16" y1="2" x2="16" y2="6"></line>
</svg>
  {{ veicolo.anno }}</p> 
                            </li>
                            <li class="mb-3"> <svg xmlns="http://www.w3.org/2000/svg"
     width="24" height="24"
     viewBox="0 0 24 24"
     fill="none"
     stroke="currentColor"
     stroke-width="2"
     stroke-linecap="round"
     stroke-linejoin="round">
  <path d="M6 22L10 2"></path>
  <path d="M18 22L14 2"></path>
  <line x1="12" y1="6" x2="12" y2="10"></line>
  <line x1="12" y1="14" x2="12" y2="18"></line>
</svg>
 {{ veicolo.chilometraggio }} Km
</li>
                            
                        </ul>
    </div>
    <div class="col-md-3">
        <ul class="list-unstyled mb-3  ">
                           
                            <li class="mb-3"><svg xmlns="http://www.w3.org/2000/svg"
     width="24" height="24"
     viewBox="0 0 24 24"
     fill="none"
     stroke="currentColor"
     stroke-width="2"
     stroke-linecap="round"
     stroke-linejoin="round">
  <rect x="3" y="3" width="12" height="18" rx="2" ry="2"></rect>
  <path d="M15 7h2a2 2 0 0 1 2 2v7a3 3 0 0 0 3 3"></path>
  <polyline points="10 9 7 14 12 14 9 19"></polyline>
</svg>

 {{ veicolo.get_tipo_carburante_display }}</li> 

<li class="mb-3"> 
    <svg xmlns="http://www.w3.org/2000/svg"
     width="24" height="24"
     viewBox="0 0 24 24"
     fill="none"
     stroke="currentColor"
     stroke-width="2"
     stroke-linecap="round"
     stroke-linejoin="round">
  <circle cx="12" cy="12" r="9"></circle>
  <line x1="12" y1="12" x2="16" y2="9"></line>
  <path d="M9 17h6"></path>
</svg>
{{ veicolo.potenza_cv }} CV</li>
</li> 

 
                        </ul>
    </div>
    <div class="col-md-3">
        <ul class="list-unstyled mb-3  ">
                           
                            <li class="mb-3"> 
                                
                                <svg xmlns="http://www.w3.org/2000/svg"
     width="24" height="24"
     viewBox="0 0 24 24"
     fill="none"
     stroke="currentColor"
     stroke-width="2"
     stroke-linecap="round"
     stroke-linejoin="round">
  <rect x="3" y="8" width="18" height="7" rx="2"></rect>
  <path d="M5 8V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v2"></path>
  <circle cx="7" cy="17" r="2"></circle>
  <circle cx="17" cy="17" r="2"></circle>
</svg>
 {{veicolo.tipo_veicolo}}

                            </li> 

<li class="mb-3"> 
    <svg xmlns="http://www.w3.org/2000/svg"
     width="24" height="24"
     viewBox="0 0 24 24"
     fill="none"
     stroke="currentColor"
     stroke-width="2"
     stroke-linecap="round"
     stroke-linejoin="round">
  <line x1="8" y1="5" x2="8" y2="19"></line>
  <line x1="16" y1="5" x2="16" y2="19"></line>
  <line x1="8" y1="12" x2="16" y2="12"></line>
  <circle cx="8" cy="5" r="1"></circle>
  <circle cx="8" cy="12" r="1"></circle>
  <circle cx="8" cy="19" r="1"></circle>
  <circle cx="16" cy="5" r="1"></circle>
  <circle cx="16" cy="12" r="1"></circle>
  <circle cx="16" cy="19" r="1"></circle>
</svg>
 {{ veicolo.get_tipo_cambio_display }}
</li>
                        </ul>
    </div>
    <div class="col-md-3">
        <ul class="list-unstyled mb-3  ">
                            
<li class="mb-3"> 
    <svg xmlns="http://www.w3.org/2000/svg"
     width="24" height="24"
     viewBox="0 0 24 24"
     fill="none"
     stroke="currentColor"
     stroke-width="2"
     stroke-linecap="round"
     stroke-linejoin="round">
  <circle cx="6" cy="6" r="2"></circle>
  <circle cx="18" cy="6" r="2"></circle>
  <circle cx="6" cy="18" r="2"></circle>
  <circle cx="18" cy="18" r="2"></circle>
  <line x1="6" y1="8" x2="6" y2="16"></line>
  <line x1="18" y1="8" x2="18" y2="16"></line>
  <line x1="8" y1="6" x2="16" y2="6"></line>
  <line x1="8" y1="18" x2="16" y2="18"></line>
</svg>
{{ veicolo.get_trazione_display }}
</li>
                            <li class="mb-3">
                                <svg xmlns="http://www.w3.org/2000/svg"
     width="24" height="24"
     viewBox="0 0 24 24"
     fill="none"
     stroke="currentColor"
     stroke-width="2"
     stroke-linecap="round"
     stroke-linejoin="round">
  <path d="M12 2C12 2 6 9 6 14a6 6 0 0 0 12 0c0-5-6-12-6-12z"></path>
</svg> {{veicolo.consumo_totale}}

                            </li>
                        </ul>
    </div>
</div>

    </div>

    <div class="row">
      {# Colonna sinistra: Galleria immagini #}
      <div class="col-lg-8">

        {# AGGIUNTO IL CONTENITORE ".gallery" RICHIESTO DA LightGallery #}
        <div class="gallery">

            <div class="mb-4">
              <a href="{{ veicolo.foto_principale.url }}">
                <img src="{{ veicolo.foto_principale.url }}"
                     class="img-fluid rounded shadow-sm w-100 veicolo-gallery-main"
                     alt="{{ veicolo.marca }} {{ veicolo.modello }}">
              </a>
            </div>

            <div class="row g-2">
              {% with total=veicolo.galleria_foto.all|length %}
                {% for img in veicolo.galleria_foto.all %}
                  {% if forloop.counter <= 2 %}
                    <div class="col-4">
                      <a href="{{ img.immagine.url }}">
                        <img src="{{ img.immagine.url }}"
                             class="img-fluid rounded shadow-sm veicolo-gallery-thumb"
                             alt="{{ img.alt_text }}">
                      </a>
                    </div>
                  {% elif forloop.counter == 3 %}
                    <div class="col-4 position-relative">
                      <a href="{{ img.immagine.url }}">
                        <img src="{{ img.immagine.url }}"
                             class="img-fluid rounded shadow-sm veicolo-gallery-thumb"
                             alt="{{ img.alt_text }}"
                             style="filter: brightness(70%);">
                        {% if total|add:"-3" > 0 %}
                          <span class="position-absolute top-50 start-50 translate-middle text-white fw-bold fs-4">
                            +{{ total|add:"-3" }}
                          </span>
                        {% endif %}
                      </a>
                    </div>
                  {% else %}
                    {# Le altre immagini restano nascoste ma i link vengono inclusi per LightGallery #}
                    <a href="{{ img.immagine.url }}" class="d-none"></a>
                  {% endif %}
                {% endfor %}
              {% endwith %}
            </div>

        </div> {# Chiusura del contenitore .gallery #}


        <h2 class="h3 mt-5 mb-3">Descrizione</h2>
        <p class="fs-lg text-muted mb-5">{{ veicolo.descrizione|linebreaksbr|default:"Nessuna descrizione disponibile." }}</p>

        <h2 class="h3 mt-5 mb-3">Dettagli del veicolo</h2>
        <div class="row mb-5">
          <div class="col-md-6">
            <ul class="list-group list-group-flush">
                <!--
              <li class="list-group-item"><strong>Marca:</strong> {{ veicolo.marca }}</li>
              <li class="list-group-item"><strong>Modello:</strong> {{ veicolo.modello }}</li>  
            -->
            <li class="list-group-item"><strong>Marca:</strong> {{ veicolo.marca }}</li>
            <li class="list-group-item"><strong>Modello:</strong> {{ veicolo.modello }}</li>
            <li class="list-group-item"><strong>Cilindrata:</strong> {{ veicolo.cilindrata }} </li>

            <li class="list-group-item"><strong>Trazione:</strong> {{ veicolo.get_trazione_display }}</li>
            <li class="list-group-item"><strong>Chilometraggio:</strong> {{ veicolo.chilometraggio }} Km</li>
            <li class="list-group-item"><strong>Carburante:</strong> {{ veicolo.get_tipo_carburante_display }}</li>

               
    
            </ul>
          </div>
          <div class="col-md-6">
            <ul class="list-group list-group-flush">
                 
            <li class="list-group-item"><strong>Consumo totale:</strong> {{veicolo.consumo_totale}}</li>
            <li class="list-group-item"><strong>Cambio:</strong> {{ veicolo.get_tipo_cambio_display }}</li>
            <li class="list-group-item"><strong>Marce:</strong> {{veicolo.marce}}</li>

             <li class="list-group-item"><strong>Colore:</strong> {{ veicolo.colore|default:"N.D." }}</li>
            <li class="list-group-item"><strong>Porte:</strong> {{ veicolo.numero_porte|default:"N.D." }}</li>
            <li class="list-group-item"><strong>Posti:</strong> {{ veicolo.numero_posti }}</li>
            </ul>
          </div>
        </div>

        {% if veicolo.box1 %}
        <h2 class="h3 mt-5 mb-3">{{veicolo.tit1}}</h2>
        <ul class="list-unstyled mb-5">
          {% for item in veicolo.box1|splitlines %}
            {% if item %}
              <li class="d-flex align-items-baseline mb-2">
               <i class="ai-check text-primary me-2"></i> {{ item }}
              </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}

        {% if veicolo.dotazione_opzionale %}
        <h2 class="h3 mt-5 mb-3">Dotazione opzionale</h2>
        <ul class="list-unstyled mb-5">
          {% for item in veicolo.dotazione_opzionale|splitlines %}
            {% if item %}
              <li class="d-flex align-items-baseline mb-2">
               <!-- <i class="ai-check text-primary me-2"></i>--> {{ item }}
              </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}


{% if veicolo.is_quality %}

        <h2 class="h3 mt-5 mb-3  ">Servizi aggiuntivi del rivenditore</h2>
        <div class="row mb-5 ">
             <div class="col-md-3 mb-3">
                                <img src="{% static 'img/quality.svg' %}" alt=""  class="img-fluid">
                            </div>
                            <div class="col-md-9"></div>
          <div class="col-md-6">
             

<p><i class="ai-check text-primary me-2"></i> Garanzie per veicoli con prestazioni di alto livello</p>

<p><i class="ai-check text-primary me-2"></i> Copertura di costi di riparazione elevati in caso di sinistro</p>

<p><i class="ai-check text-primary me-2"></i> Autorizzazione velocissima alla riparazione del danno per rientrare in possesso del veicolo in breve tempo </p>


          </div>
           <div class="col-md-6">
        <p>     <i class="ai-check text-primary me-2"></i> Nessun anticipo finanziario in caso di sinistro in Svizzera</p>

<p> <i class="ai-check text-primary me-2"></i> Copertura in tutta Europa secondo la carta internazionale d’assicurazione</p>


          </div>
          <div class="col-md-3"> 
<a href="https://www.quality1.ch/it/offerte/auto.html" target="_blank" rel="noopener noreferrer">
  Saperne di più
</a>

          </div>
        </div>

{% endif%}





      </div>

      {# Colonna destra: Modulo contatto #}
      <div class="col-lg-4">
        <div class="card p-4 shadow-sm border-0 sticky-top" style="top: 100px;">
          <h4 class="card-title text-center mb-4">Richiesta di informazioni</h4>
          <p class="text-muted mb-4">Compila il modulo per ricevere <br>
maggiori dettagli su questo veicolo
</p>
          <form action="{% url 'main:contatti' %}" method="get">
            <div class="mb-3">
              <label for="id_nome" class="form-label">Nome completo</label>
              <input type="text" class="form-control" id="id_nome" name="nome" required>
            </div>
            <div class="mb-3">
              <label for="id_email" class="form-label">Email</label>
              <input type="email" class="form-control" id="id_email" name="email" required>
            </div>
            <div class="mb-3">
              <label for="id_messaggio" class="form-label">Messaggio</label>
              <textarea class="form-control" id="id_messaggio" name="messaggio" rows="5" required>
Sono interessato al veicolo {{ veicolo.marca }} {{ veicolo.modello }} (Anno {{ veicolo.anno }}, Km {{ veicolo.chilometraggio }}).
              </textarea>
            </div>
            <input type="hidden" name="veicolo_riferimento" value="{{ veicolo.id }}">
            <button type="submit" class="btn btn-primary w-100">Invia richiesta</button>
             
             <a class="btn btn-success mt-2 w-100"href="https://wa.me/41765322296?text=Sono%20interessato%20al%20veicolo%20{{veicolo.marca}}%20{{veicolo.modello}}%20(Anno%20{{veicolo.anno}},%20Km%20{{veicolo.chilometraggio|intcomma}})."
   target="_blank" rel="noopener"><i class="ai-whatsapp fs-xl me-2 ms-n1"></i> 
Contatto diretto
      
            </a>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
<!--
{% if altri_veicoli %}
<section class="container mt-5 py-5 border-top">
  <h2 class="h1 text-center mb-5">Potrebbe interessarti anche</h2>
  <div class="row">
    {% for altro_veicolo in altri_veicoli %}
    <div class="col-md-4">
      <div class="card h-100 shadow-sm border-0">
        <img src="{{ altro_veicolo.foto_principale.url }}"
             class="card-img-top object-fit-cover"
             alt="{{ altro_veicolo.marca }} {{ altro_veicolo.modello }}"
             style="height: 200px;">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ altro_veicolo.marca }} {{ altro_veicolo.modello }}</h5>
          <p class="card-text text-primary fs-5 fw-bold mb-2">{{ altro_veicolo.prezzo|intcomma }} CHF</p>
          <div class="fs-sm text-muted">
             
          </div>
          <a href="{% url 'vendita:dettaglio_veicolo' slug=altro_veicolo.slug %}" class="btn btn-outline-primary mt-3 mt-auto">Vedi Dettagli</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

-->
<div class="mt-5"></div>
{% endblock %}

{% block extra_js %}
{# RIMOSSO GLightbox.js, AGGIUNTO LightGallery.js e i suoi plugin #}
<script src="{% static 'vendor/lightgallery/lightgallery.min.js' %}"></script>
<script src="{% static 'vendor/lightgallery/plugins/fullscreen/lg-fullscreen.min.js' %}"></script>
<script src="{% static 'vendor/lightgallery/plugins/zoom/lg-zoom.min.js' %}"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // Seleziona il contenitore della galleria che abbiamo aggiunto nell'HTML
  const galleryContainer = document.querySelector('.gallery');
  if (galleryContainer) {
    lightGallery(galleryContainer, {
      plugins: [lgZoom, lgFullscreen],
      selector: 'a', // Cerca tutti i link 'a' all'interno del contenitore
      download: false,
      speed: 500,
      loop: true
    });
  }
});
</script>
{% endblock %}